edited working cop of Matlab code -Anthony